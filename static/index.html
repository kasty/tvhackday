<!DOCTYPE html>
<html lang="fr">
<head>
	<meta charset="utf-8" />
	<title>ARTE Concert - Join the band !</title>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="css/jointheband.css" type="text/css" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script type="text/javascript">
	$(document).on('ready', function() {
	var currentUsers = {};
	var joinBand = function(userID, points, score) {
		this.user = userID;
		this.score = score;
		this.points = points;
		this.container = $('#container');
		if(this.container.find('#joined').length == 0) this.container.append('<div id="joined"></div>');
		if(this.container.find('#points').length == 0) this.container.append('<div id="points"></div>');
		//create a new user
		this.createUser = function() {
			currentUsers[this.user] = {};
			currentUsers[this.user].totalScore = 0;
			$('#joined').stop().show().html(this.user+' joined !').animate({fontSize : '100px'}, 500, function() {
				$('#joined').fadeOut('slow', function() { $('#joined').empty().removeAttr('style'); ; });
			});
			this.outputScore();
		}
		//update user score
		this.updateUser = function() {
			currentUsers[this.user].totalScore = score;
			this.outputScore();
			this.displayPoints();
		}
		//display score table
		this.outputScore = function() {
			$('#scoring').empty().html('<ul id="classement"></ul>');
			$.each(currentUsers, function(key, value) {
				console.log(key, value);
				$('#classement').append('<li>'+key+' : '+value.totalScore+'</li>');
			});
		}
		//display the player's points
		this.displayPoints = function() {
			var that = this;
			if($('#points').find('#'+that.user).length == 0)
				$('#points').append('<div id="'+that.user+'"></div>');
			
			$('#'+that.user).hide().html(that.user+'<br />+'+that.points).fadeIn('fast', function() {
				console.log('setTimeout');
				setTimeout(function() { console.log(that.user); $('#'+that.user).fadeOut(); }, 600);
			}
			);
			
			
		}
	};
	
	$('form').submit(function(evt) {
		evt.preventDefault();
		
		var user = $('input[name=user]').val();
		var points = $('input[name=points]').val();
		var score = $('input[name=score]').val();
		
		markPoint(user, points, score);
		});
		
		function markPoint(user, points, score) {
			if(typeof currentUsers[user] !== "undefined") {
				var join = new joinBand(user, points, score);
				join.updateUser();
			}
			else {
				console.log('new user');
				var join = new joinBand(user, points, score);
				join.createUser();
			}
		}
	});
	</script>
	<style type="text/css">
	#joined { position:absolute; height:200px; width:100%; border:1px solid red; top:50%; margin-top:-100px; text-align: center; font-size:12px; }
	#points { border:1px solid red; width:60px; height:60px; font-size:50px; text-align:center; float:right; margin-right:100px; }
	</style>
</head>
<body>
<header>
	<h1>Join the band !</h1>
</header>
<div id="scoring">

</div>
<div id="main">
<div id="container"></div>

<form method="post">
<input type="text" name="user" value="" /><input type="text" name="points" /><input type="text" name="score" />
<input type="submit" id="test" value="TEST" />
</form>
</div>
</body>
</html>
